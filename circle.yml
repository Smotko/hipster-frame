machine:
  python:
    version: 3.5.2

general:
  artifacts:
    - "frontend/coverage"
    - "api/htmlcov"

dependencies:
  cache_directories:
    - "frontend/node_modules"
  override:
    - npm install:
        pwd:
          frontend
    - pip install -r requirements.txt:
        pwd:
          api

test:
  override:
    - npm test -- --coverage:
        pwd:
          frontend
        environment:
          CI: true
    - "coverage run -m unittest discover src '*_test.py' && coverage report && coverage html":
        pwd:
          api
        environment:
          DB_PASSWORD: postgres
          DB_USERNAME: postgres
          DB_HOST: db
          DB_PORT: 5432
          CLIENT_ID: 123
          CLIENT_SECRET: secret
          REDIRECT_URI: "http://localhost:8080/api/instagram/callback"
          SECRET_KEY: secretkey
          SERVER_URI: "http://localhost:8080"
  post:
    - bash <(curl -s https://codecov.io/bash) -f /home/ubuntu/hipster-frame/frontend/coverage/clover.xml -f /home/ubuntu/hipster-frame/frontend/coverage/coverage-final.json -f /home/ubuntu/hipster-frame/api/coverage.xml
